<!DOCTYPE html>
<html lang="zh-CN">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="derekdomo" />


    
    


<meta property="og:type" content="website">
<meta property="og:title" content="ALittleMoreEveryday">
<meta property="og:url" content="www.derekdomo.com/index.html">
<meta property="og:site_name" content="ALittleMoreEveryday">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ALittleMoreEveryday">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="ALittleMoreEveryday" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/avatar.jpeg">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">


    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>ALittleMoreEveryday</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.jpeg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">derekdomo</a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:pysunxiangyu@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bestbuy/">Bestbuy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PS4/">PS4</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Server/">Server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Work/">Work</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/找工作/">找工作</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/新知识/">新知识</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/羊毛/">羊毛</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">derekdomo</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.jpeg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">derekdomo</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:pysunxiangyu@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-leetcode-2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/15/leetcode-2/" class="article-date">
      <time datetime="2017-05-16T05:00:00.000Z" itemprop="datePublished">2017-05-15</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/15/leetcode-2/">Leetcode-[3Sum Closest]</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Problem-Definition"><a href="#Problem-Definition" class="headerlink" title="Problem Definition"></a>Problem Definition</h1><p>Given an array nums of n integers and an integer target, find three integers in nums such that the sum is closest to target. Return the sum of the three integers. You may assume that each input would have exactly one solution.</p>
<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">class Solution(object):</div><div class="line">    def threeSumClosest(self, nums, target):</div><div class="line">        nums.sort()</div><div class="line">        lenght = len(nums)</div><div class="line">        closestSum = nums[0] + nums[1] + nums[2]</div><div class="line">        smallestDiff = target - closestSum </div><div class="line">        for i in xrange(length-2):</div><div class="line">            left = ind+1</div><div class="line">            right  = length-1</div><div class="line">            while left &lt; right:</div><div class="line">                sum = nums[i] + nums[left] + nums[right]</div><div class="line">                diff = target-sum</div><div class="line">                if diff == 0:</div><div class="line">                    return target</div><div class="line">                elif diff &gt; 0:</div><div class="line">                    right = right -1</div><div class="line">                else:</div><div class="line">                    left = left + 1</div><div class="line">                if abs(smallestDiff) &lt; abs(diff):</div><div class="line">                    smallestDiff = diff</div><div class="line">                    closestSum = sum</div><div class="line">        return closestSum</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Leetcode/">Leetcode</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/找工作/">找工作</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-leetcode-1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/14/leetcode-1/" class="article-date">
      <time datetime="2017-05-15T05:00:00.000Z" itemprop="datePublished">2017-05-14</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/14/leetcode-1/">Leetcode-[Container with most water]</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Problem-Definition"><a href="#Problem-Definition" class="headerlink" title="Problem Definition"></a>Problem Definition</h1><p>Given n non-negative integers a1, a2, …, an, where each represents a point at coordinate (i, ai). n vertical lines are drawn such that the two endpoints of line i is at (i, ai) and (i, 0). Find two lines, which together with x-axis forms a container, such that the container contains the most water.</p>
<p>Note: You may not slant the container and n is at least 2.</p>
<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><ul>
<li>container的定义在这里很迷惑，数组里每一个数字代表的一个bar，这个bar就是container的边界，而container的体积则是由两个container的边界的中的最小值和两个边界之间的距离决定的, 这意味着中间的bar是忽略不记的。。</li>
<li>还有一个题的container则是相反的，中间的bar不仅要作为边界，还要作为容器的底的。。。。</li>
<li>弄清楚概念之后，直观的想法是DP，我最一开始的想法是把容器氛围两类<ul>
<li>一类是左边比右边高，一类是右边比左边高</li>
<li>这样两轮遍历数组，每次找比之前更高的</li>
<li>但是这样的问题是另一边的边界不好找</li>
</ul>
</li>
<li>转换思路后，觉得two pointer可能可行，这样两边的边界都可以确定</li>
<li>虽然直觉上觉得这样能得到最优解，但是怎么证明呢<ul>
<li>首先我们可以得到的一个解是min(a[0], a[n-1]) * (n-1)</li>
<li>那么如果a[0] &lt; a[n-1]的话，那么剩下的最优解一定在a[1:]中</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">class Solution:</div><div class="line">    def findContainerWithMostWater(self, bars):</div><div class="line">        n = len(bars)</div><div class="line">        maxWater = (n-1) * min(bars[0], bars[-1])</div><div class="line">        if bars[0] &lt; bars[-1]:</div><div class="line">            return max(maxWater, self.findContainerWithMostWater(bars[1:]))</div><div class="line">        else:</div><div class="line">            return max(maxWater, self.findContainerWithMostWater(bars[:-1]))</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Leetcode/">Leetcode</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/找工作/">找工作</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2017-04-18" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/04/17/2017-04-18/" class="article-date">
      <time datetime="2017-04-18T05:40:05.000Z" itemprop="datePublished">2017-04-17</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/17/2017-04-18/">Cherami使用心得</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>新的项目需要一个queue service来处理一下use case:</p>
<ul>
<li>task必须要执行至少一次</li>
<li>分布式的queue，所以workload可以分到不同机器上</li>
<li>因为有些task耗时比较长，需要asynchronous，所以需要提供检查这个job完成没有完成的功能</li>
</ul>
<p>然而Cherami只能用来当一个单纯的queue service，就像SQS一样。。所以只能半造轮子，半用Cherami来做了。</p>
<p><img src="img/cherami.png" alt="Screen Shot 2017-04-24 at 1.43.01 P"></p>
<p>新的服务需要设置两个server类型，</p>
<ul>
<li>一个是前端</li>
<li>一个是后端</li>
</ul>
<p>前端会用公司内部支持的thrift来接受请求，然后通过cherami来publish message。后端用来通过cherami来consume message，完成task。<br>现在算是有了基本的功能，但是有几个比较tricky的地方没有解决。</p>
<ul>
<li>Status Tracking: 因为有些task跑的时间很长，所以需要提供track status的功能。</li>
<li>Retry Mechanism: 如果task失败了的话，应该要想办法自动retry。</li>
<li>Duplicate: cherami只能保证at least once，这样子的话，就又可能会出现duplicates。</li>
</ul>
<h2 id="Status-Tracking-Table"><a href="#Status-Tracking-Table" class="headerlink" title="Status Tracking Table"></a>Status Tracking Table</h2><ul>
<li>前段在接受了请求之后会生成一个job id，然后把job id加到table中，mark为accepted。</li>
<li>然后后端接受任务后会先检查一下这个job的status是不是accepted，<ul>
<li>如果不是的话，那就是duplicate了，会立刻drop掉；</li>
<li>如果是的话，就update成running</li>
</ul>
</li>
<li>如果这个task失败了就会update成failure，然后发一个一模一样的request给cherami，相当于重新进queue。</li>
</ul>
<h2 id="Possible-Issues"><a href="#Possible-Issues" class="headerlink" title="Possible Issues "></a>Possible Issues </h2><ul>
<li>Race Condition: 如果一个request进了frontend，然后先发送了请求给cherami，然后再update，这样子就有可能，还没来及的update，consumer就已经接收到请求了。或者先update了数据库，然后发送请求给了cherami，如果cherami坏掉了，或者信息丢掉了，这个请求就会一直处于accept状态。</li>
</ul>
<p>这种情况，我倾向于第二种选择，因为首先cherami不大可能会丢掉信息。即便如果丢掉信息的话，数据库里存着这个数据请求的记录，所以可以想办法来处理这种情况，比如说一个请求如果太久没有update状态，那基本可以重发信息给cherami。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Work/">Work</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Work/">Work</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/新知识/">新知识</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2017-03-02" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/03/02/2017-03-02/" class="article-date">
      <time datetime="2017-03-03T06:40:05.000Z" itemprop="datePublished">2017-03-02</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/02/2017-03-02/">纪念一个被ssh荒废的下午</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>昨天手贱把公司的电脑的环境重新配了一下，结果导致我的电脑的环境崩坏了，要是平时还就算了，还是在我oncall的时候。。折腾了一下，终于解决了这个问题。原因是因为我安装了一个新的ssh，和default的ssh的区别不是很多，但是有个很致命的不同，就是system-wide ssh_config不一样，一个是在/etc/ssh/ssh_config，一个是在/usr/local/etc/ssh/ssh_config。我之前一直以为是我的别的设置出了问题，就把engducation的ppt研究了好几遍，也没发现哪里出了问题。结果man ssh_config了一下，就发现了问题。。。</p>
<p>总结一下这次个人outage的经验：</p>
<ul>
<li>如果这个配置文件你不懂，千万不要乱改</li>
<li>出了问题，不要盲目的去跟着网上的，或者其他的教程乱来，因为那些可能解决不了你的问题。还是得自己静下心来，去分析，然后去解决。</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Work/">Work</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Work/">Work</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/新知识/">新知识</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2017-02-14" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/14/2017-02-14/" class="article-date">
      <time datetime="2017-02-15T06:40:05.000Z" itemprop="datePublished">2017-02-14</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/14/2017-02-14/">Memorizing the data</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>最近读了一篇paper，Understanding deep learning requires rethinking Generalization。简直是现在DL热潮中一股清流。</p>
<h1 id="Memorizing-the-data"><a href="#Memorizing-the-data" class="headerlink" title="Memorizing the data"></a>Memorizing the data</h1><ul>
<li>我对这篇文章印象最深的一句话：The effective capacity of neural networks is large enough for a brute-force memorization of the entire data set. </li>
<li>他们做了几个实验，就是把训练数据的label全部打乱，然后在这基础上训练几个不同类型的神经网络，结果发现都可以达到zero training error。这就不得不让人觉得神经网络知识记住这些data而已，并没有从中总结出规律。</li>
<li>闲扯一下，真的神经网络不就是这样子么，记录东西，下次有相似的事情发生时，可以知道如何应对，这就是学习的过程啊。只不过现在感觉主要的工业界需求在于机器学习带来的insights，得到数据中隐藏的规律。</li>
</ul>
<h1 id="Regularization"><a href="#Regularization" class="headerlink" title="Regularization"></a>Regularization</h1><p>regularization运用在模型中，可以提升模型的generalization，避免overfitting。我理解中的regularizer的确是这样子，但是这个paper说到，finely tuned parameters of regularizer can improve generalization, but it is not the fundamental reasons of generalization。因为他们在实验中发现去掉regularizer，神经网络也可以表现得很好。。。<br>提到regularization，一共有以下几种常用的：</p>
<ul>
<li>Data augmentation<ul>
<li>augment dataset according to some domain specific knowledge</li>
</ul>
</li>
<li>Weight Decay<ul>
<li>something like l2 regularizer</li>
</ul>
</li>
<li>Dropout<ul>
<li>mask out each element of a layer output randomly with a given dropout probability.</li>
</ul>
</li>
</ul>
<h1 id="Random-thoughts"><a href="#Random-thoughts" class="headerlink" title="Random thoughts"></a>Random thoughts</h1><p>最近总有一些很奇怪的想法，如果神经网络是在memorize data，那这个能用来压缩数据么？如果一些数据的目的性十分明确，那何尝不是一个方法，训练完就可以丢掉，需要存储的存储的只是几个parameter而已，只是问题是怎么把新数据加进来，同时又不会造成之前的数据信息丢失。<br>Anyway，总的来说这篇文章还是挺有意思的，因为当下deep learning实在是太火，但是很难去理解这个模型，工业界的运用有时候不仅仅是正确率是唯一metrics，更多的是需要模型来教给人一些东西，来提供更多的insights。这个从generalization的角度去分析现在的神经网络的局限性，提出这个模型只是单纯的在记录数据。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/DataScience/">DataScience</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/新知识/">新知识</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2017-02-08" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/08/2017-02-08/" class="article-date">
      <time datetime="2017-02-08T08:00:00.000Z" itemprop="datePublished">2017-02-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/08/2017-02-08/">Job Scheduler杂谈</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>自从工作之后算是用了几种不一样的job scheduler，现在回想比较一下各种服务器，有些比较浅显的感想。不从实现细节上考虑，只从使用性角度分析。</p>
<h2 id="Cron"><a href="#Cron" class="headerlink" title="Cron"></a>Cron</h2><p>Unix自带的cron，十分方便便捷的一个工具。</p>
<ul>
<li>便于debug，便于开发，</li>
<li>但是还是属于比较hack的方法，不稳定。总结一下缺点，感觉就是两点，<ul>
<li>一点是如果这个机器负荷太大，或者说突然down了，基本上你的job就GG了，</li>
<li>还有一个就是不太容易监控，如果job fail的话，很难去发现。</li>
</ul>
</li>
</ul>
<h2 id="Celery"><a href="#Celery" class="headerlink" title="Celery"></a>Celery</h2><p>Celery框架里自带了一个cron功能，</p>
<ul>
<li>总的来说上一点提到的问题算是被解决了，因为他的工作原理和cron差不多，只不过每一个cron job就是一个celery task，所以会提交一个celery task，然后进去celery queue，被指配给一个机器去跑，所以即便出了问题，也没什么影响。</li>
<li>但是第二个问题还存在，就是失败了，很难发现。</li>
</ul>
<p>我们现在用的解决办法就是每个job结束之后会emit一些metric，然后基于这个metric，我们设置一些alert。但是效果不是特别理想。组里有个比较资深的eng不是特别喜欢这种方法。</p>
<h2 id="Airflow"><a href="#Airflow" class="headerlink" title="Airflow"></a>Airflow</h2><p>Airbnb开源的一个job scheduler，底层貌似也是celery，不太确定。</p>
<ul>
<li>感觉就是着重去解决第二点的，他有一个特别好看的UI，用起来也比较方便。用起来算是ok吧，不算特别复杂。</li>
<li>但是这个有个缺点，就是pipeline的代码和scheduler的代码在一起，导致这个code base过于的大。</li>
</ul>
<p>总的来说是个不错scheduler，但是可能是我司的使用方法的问题，jenkins每次build，要把scheduler的code base给build一遍，这个简直太慢了，而且每个pipeline对自己的library有自己的要求，所以要求scheduler安装所有的lib，这个就把这个build变的更恐怖。你敢想象每次build都要把numpy, pandas, scipy这种级别的library分别装一遍么。</p>
<h2 id="AWS-Lambda"><a href="#AWS-Lambda" class="headerlink" title="AWS Lambda"></a>AWS Lambda</h2><p>写着写着又想到自己实习的那个组的产品，</p>
<ul>
<li>这个和celery差不多，也是分布式的，有个界面，虽然界面不咋地</li>
<li>可以上传自己的代码，和附上自己的requirement.txt。还可以版本管理，但不如git方便</li>
<li>AWS服务友好，可以十分轻松的使用其他的服务<br>不知道他们的pitch现在是什么，这个服务的可能性太多了，即便是单纯做scheduler，event trigger还是micro service，都应该挺有前景的。</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Work/">Work</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Work/">Work</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2017-02-07" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/07/2017-02-07/" class="article-date">
      <time datetime="2017-02-07T08:00:00.000Z" itemprop="datePublished">2017-02-07</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/07/2017-02-07/">Daily Summary Email的轮子</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>最近搞了一个新的pipeline，里面涉及了数据处理，训练模型，结果分析好几步。因为在实现的时候没有考虑以后可能会monitor这个pipeline的东西，所以没有像之前的那个pipeline一样在每一步会记录一些中间结果在数据库里，这个只是dump了一些中间文件在HDFS里。为了更好的监督整个过程，我写了简单的轮子，基本上就是一个cron job，每天把那些中间结果从hdfs里爬出来然后总结一下，生成一个html版的summary，通过email发给大家，效果还不错，可以帮助较早的发现问题。<br>但是总结一下，觉得其实还是在实现的时候考虑一些monitor的因素会比较好，现在这个方式虽然效果很好，但是太hack了。最好的方法还是实现过程中，把一些关键的中间数据存储在数据库中，这样子无论是用现成的looker之类的工具，还是自己造轮子都很方便。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Work/">Work</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Work/">Work</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2017-01-08" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/08/2017-01-08/" class="article-date">
      <time datetime="2017-01-09T06:40:05.000Z" itemprop="datePublished">2017-01-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/08/2017-01-08/">Gaussian Process Regression</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Bayesian-methods"><a href="#Bayesian-methods" class="headerlink" title="Bayesian methods"></a>Bayesian methods</h1><p>很多经典的ml model都是可以简化为下面这个问题：</p>
<ul>
<li>Given a dataset generated from some distributions</li>
<li>Solve a convex optimization problem in order to find the best fit model for the training data</li>
<li>Use the model to predict<br>但是bayesian比较特殊，它不会学习出一个best fit的model，而是根据训练数据学习出新数据的后验概率。这样可以提供方法让我们去衡量模型中的不确定性，从而对未见过的新数据做出比较robust的预测。</li>
</ul>
<h1 id="Gaussian-Process"><a href="#Gaussian-Process" class="headerlink" title="Gaussian Process"></a>Gaussian Process</h1><h2 id="Intuitive-Explanation"><a href="#Intuitive-Explanation" class="headerlink" title="Intuitive Explanation"></a>Intuitive Explanation</h2><p>GP中比较核心的一个就是covariance matrix</p>
<ul>
<li>training-training cov matrix</li>
<li>training-testing cov matrix</li>
</ul>
<p>100个训练数据和10个测试数据，就意味着我们有一个110维的joint gaussian distribution，我们可以通过这个100数据推出10个测试数据的条件分布。浅显的说，就是我们综合所有的训练数据，拿测试数据和他们一一比较相似性，从而得出了一个weighted average预测值。这也是为什么GP是一个Non-parametric model，这个模型记录了所有的数据，然后根据记录的这些数据来预测新数据。</p>
<p>最早这个模型貌似适用于地质勘探的，对于一片地表，如果我们随机采样几个点，判断有没有石油（忘记是石油还是判断地质了，估计差不多吧），然后能够推测出一个新的点有没有石油。</p>
<h2 id="Modeling-the-Cov-Matrix"><a href="#Modeling-the-Cov-Matrix" class="headerlink" title="Modeling the Cov Matrix"></a>Modeling the Cov Matrix</h2><ul>
<li>既然是个non-parametrix model，和普通的linear regression相比，是没有什么参数可以调的，所有的都是根据cov matrix来计算出来一个条件概率得到预测值的。</li>
<li>但是构建cov matrix中，我们是可以利用一个kernel来添加一些参数到这个模型里，来”强行调参“。</li>
<li>在cov matrix里面，我们用kernel来计算两个点的相似度，石油开采的例子中我们可以用两个点的直线距离（欧几里得距离），我们也可以用RBF，Matern等等等。这些感觉还是需要一些经验，和实验，来判断什么样的kernel才是最适合这个模型的。举个例子，假如说你用的feature如果不是等同重要，有写很重要，有些不重要的话，那用ARD会更好一些，这样你在训练过程中，就可以把不重要的feature的lengthscale学的大一些，从而降低它的影响。</li>
</ul>
<h2 id="Optimization"><a href="#Optimization" class="headerlink" title="Optimization"></a>Optimization</h2><p>看了很多资料和很多lib的实现，大家的objective function都是一样的，都是那个marginal likelihood，但是具体的优化方法却不太一样，有的使用conjugate gradient。但是我自己试过这几个，感觉效果都不是很好，反而是grid search比较好，但是如果parameter太多的话，就又会比较爆炸。。<br>相较于自己实现，有几个library，比如GPy，用的是scipy的opt方法，而且效果比较好，应该是里面有些tricks我没有用到，导致了我实现的不converge。</p>
<h2 id="Tricks-in-Implementation"><a href="#Tricks-in-Implementation" class="headerlink" title="Tricks in Implementation"></a>Tricks in Implementation</h2><p>实现的过程中发现很多tricks，可以导致效果差别特别大，或者根本就计算不了，或者特别慢。</p>
<ul>
<li>Log scale：除了普通的normalization，对训练数据进行log scale可以让RMSE大大提高。</li>
<li>de-dup：在生成cov matrix时，如果有两条训练数据相同，会导致这个矩阵没有办法算inverse，所以需要去重。 </li>
<li>Add noise：即便没有重复的，但是如果有两个点特别像，在计算的时候还是会导致无法inverse。所以需要在对角线上加noise，是这个矩阵可以inverse。</li>
<li>Blas,blahblahblah：因为我是用scala的breeze，它底层用的是netlib。但是公司的机器里somehow部署时，既没有用ref-blas(pre-built版)，也没有native-blas，所以在计算inverse时特别的慢，这点需要注意一下，可以提升很高速度。</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/DataScience/">DataScience</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/新知识/">新知识</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2018 derekdomo
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-89151683-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>